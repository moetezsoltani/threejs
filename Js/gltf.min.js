THREE.GLTFLoader=function(){function y(b){THREE.Loader.call(this,b);this.ddsLoader=this.dracoLoader=null}function U(){var b={};return{get:function(a){return b[a]},add:function(a,c){b[a]=c},remove:function(a){delete b[a]},removeAll:function(){b={}}}}function V(b){if(!b)throw Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=h.MSFT_TEXTURE_DDS;this.ddsLoader=b}function G(b){this.name=h.KHR_LIGHTS_PUNCTUAL;this.lightDefs=(b.extensions&&b.extensions[h.KHR_LIGHTS_PUNCTUAL]||
{}).lights||[]}function D(){this.name=h.KHR_MATERIALS_UNLIT}function W(b){this.name=h.KHR_BINARY_GLTF;this.body=this.content=null;var a=new DataView(b,0,z);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(b.slice(0,4))),version:a.getUint32(4,!0),length:a.getUint32(8,!0)};if(this.header.magic!==H)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(2>this.header.version)throw Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var a=
new DataView(b,z),c=0;c<a.byteLength;){var e=a.getUint32(c,!0),c=c+4,d=a.getUint32(c,!0),c=c+4;d===I.JSON?(d=new Uint8Array(b,z+c,e),this.content=THREE.LoaderUtils.decodeText(d)):d===I.BIN&&(d=z+c,this.body=b.slice(d,d+e));c+=e}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.");}function J(b,a){if(!a)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=h.KHR_DRACO_MESH_COMPRESSION;this.json=b;this.dracoLoader=a}function K(){this.name=h.KHR_TEXTURE_TRANSFORM}
function X(){return{name:h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:"color map lightMap lightMapIntensity aoMap aoMapIntensity emissive emissiveIntensity emissiveMap bumpMap bumpScale normalMap displacementMap displacementScale displacementBias specularMap specular glossinessMap glossiness alphaMap envMap envMapIntensity refractionRatio".split(" "),getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(b,a,c){a=a.extensions[this.name];var e=THREE.ShaderLib.standard,
d=THREE.UniformsUtils.clone(e.uniforms),g=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>","#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif").replace("#include <metalnessmap_pars_fragment>","#ifdef USE_GLOSSINESSMAP\n\tuniform sampler2D glossinessMap;\n#endif").replace("#include <roughnessmap_fragment>","vec3 specularFactor = specular;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\ttexelSpecular = sRGBToLinear( texelSpecular );\n\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tspecularFactor *= texelSpecular.rgb;\n#endif").replace("#include <metalnessmap_fragment>",
"float glossinessFactor = glossiness;\n#ifdef USE_GLOSSINESSMAP\n\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );\n\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture\n\tglossinessFactor *= texelGlossiness.a;\n#endif").replace("#include <lights_physical_fragment>","PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );\nmaterial.specularColor = specularFactor.rgb;");delete d.roughness;
delete d.metalness;delete d.roughnessMap;delete d.metalnessMap;d.specular={value:(new THREE.Color).setHex(1118481)};d.glossiness={value:.5};d.specularMap={value:null};d.glossinessMap={value:null};b.vertexShader=e.vertexShader;b.fragmentShader=g;b.uniforms=d;b.defines={STANDARD:""};b.color=new THREE.Color(1,1,1);b.opacity=1;e=[];Array.isArray(a.diffuseFactor)&&(d=a.diffuseFactor,b.color.fromArray(d),b.opacity=d[3]);void 0!==a.diffuseTexture&&e.push(c.assignTexture(b,"map",a.diffuseTexture));b.emissive=
new THREE.Color(0,0,0);b.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1;b.specular=new THREE.Color(1,1,1);Array.isArray(a.specularFactor)&&b.specular.fromArray(a.specularFactor);void 0!==a.specularGlossinessTexture&&(a=a.specularGlossinessTexture,e.push(c.assignTexture(b,"glossinessMap",a)),e.push(c.assignTexture(b,"specularMap",a)));return Promise.all(e)},createMaterial:function(b){var a=new THREE.ShaderMaterial({defines:b.defines,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,
uniforms:b.uniforms,fog:!0,lights:!0,opacity:b.opacity,transparent:b.transparent});a.isGLTFSpecularGlossinessMaterial=!0;a.color=b.color;a.map=void 0===b.map?null:b.map;a.lightMap=null;a.lightMapIntensity=1;a.aoMap=void 0===b.aoMap?null:b.aoMap;a.aoMapIntensity=1;a.emissive=b.emissive;a.emissiveIntensity=1;a.emissiveMap=void 0===b.emissiveMap?null:b.emissiveMap;a.bumpMap=void 0===b.bumpMap?null:b.bumpMap;a.bumpScale=1;a.normalMap=void 0===b.normalMap?null:b.normalMap;b.normalScale&&(a.normalScale=
b.normalScale);a.displacementMap=null;a.displacementScale=1;a.displacementBias=0;a.specularMap=void 0===b.specularMap?null:b.specularMap;a.specular=b.specular;a.glossinessMap=void 0===b.glossinessMap?null:b.glossinessMap;a.glossiness=b.glossiness;a.alphaMap=null;a.envMap=void 0===b.envMap?null:b.envMap;a.envMapIntensity=1;a.refractionRatio=.98;a.extensions.derivatives=!0;return a},cloneMaterial:function(b){var a=b.clone();a.isGLTFSpecularGlossinessMaterial=!0;for(var c=this.specularGlossinessParams,
e=0,d=c.length;e<d;e++){var g=b[c[e]];a[c[e]]=g&&g.isColor?g.clone():g}return a},refreshUniforms:function(b,a,c,e,d){if(!0===d.isGLTFSpecularGlossinessMaterial){a=d.uniforms;c=d.defines;a.opacity.value=d.opacity;a.diffuse.value.copy(d.color);a.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity);a.map.value=d.map;a.specularMap.value=d.specularMap;a.alphaMap.value=d.alphaMap;a.lightMap.value=d.lightMap;a.lightMapIntensity.value=d.lightMapIntensity;a.aoMap.value=d.aoMap;a.aoMapIntensity.value=
d.aoMapIntensity;var g;d.map?g=d.map:d.specularMap?g=d.specularMap:d.displacementMap?g=d.displacementMap:d.normalMap?g=d.normalMap:d.bumpMap?g=d.bumpMap:d.glossinessMap?g=d.glossinessMap:d.alphaMap?g=d.alphaMap:d.emissiveMap&&(g=d.emissiveMap);void 0!==g&&(g.isWebGLRenderTarget&&(g=g.texture),!0===g.matrixAutoUpdate&&g.updateMatrix(),a.uvTransform.value.copy(g.matrix));d.envMap&&(a.envMap.value=d.envMap,a.envMapIntensity.value=d.envMapIntensity,a.flipEnvMap.value=d.envMap.isCubeTexture?-1:1,a.reflectivity.value=
d.reflectivity,a.refractionRatio.value=d.refractionRatio,a.maxMipLevel.value=b.properties.get(d.envMap).__maxMipLevel);a.specular.value.copy(d.specular);a.glossiness.value=d.glossiness;a.glossinessMap.value=d.glossinessMap;a.emissiveMap.value=d.emissiveMap;a.bumpMap.value=d.bumpMap;a.normalMap.value=d.normalMap;a.displacementMap.value=d.displacementMap;a.displacementScale.value=d.displacementScale;a.displacementBias.value=d.displacementBias;null!==a.glossinessMap.value&&void 0===c.USE_GLOSSINESSMAP&&
(c.USE_GLOSSINESSMAP="",c.USE_ROUGHNESSMAP="");null===a.glossinessMap.value&&void 0!==c.USE_GLOSSINESSMAP&&(delete c.USE_GLOSSINESSMAP,delete c.USE_ROUGHNESSMAP)}}}}function r(b,a,c,e){THREE.Interpolant.call(this,b,a,c,e)}function L(b,a){if("string"!==typeof b||""===b)return"";/^https?:\/\//i.test(a)&&/^\//.test(b)&&(a=a.replace(/(^https?:\/\/[^\/]+).*/i,"$1"));return/^(https?:)?\/\//i.test(b)||/^data:.*,.*$/i.test(b)||/^blob:.*$/i.test(b)?b:a+b}function v(b,a,c){for(var e in c.extensions)void 0===
b[e]&&(a.userData.gltfExtensions=a.userData.gltfExtensions||{},a.userData.gltfExtensions[e]=c.extensions[e])}function t(b,a){void 0!==a.extras&&("object"===typeof a.extras?Object.assign(b.userData,a.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+a.extras))}function Y(b,a,c){for(var e=!1,d=!1,g=0,f=a.length;g<f;g++){var k=a[g];void 0!==k.POSITION&&(e=!0);void 0!==k.NORMAL&&(d=!0);if(e&&d)break}if(!e&&!d)return Promise.resolve(b);for(var m=[],l=[],g=0,f=a.length;g<f;g++){k=
a[g];if(e){var n=void 0!==k.POSITION?c.getDependency("accessor",k.POSITION):b.attributes.position;m.push(n)}d&&(n=void 0!==k.NORMAL?c.getDependency("accessor",k.NORMAL):b.attributes.normal,l.push(n))}return Promise.all([Promise.all(m),Promise.all(l)]).then(function(c){var g=c[0];c=c[1];for(var f=0,m=g.length;f<m;f++)b.attributes.position!==g[f]&&(g[f]=M(g[f]));f=0;for(m=c.length;f<m;f++)b.attributes.normal!==c[f]&&(c[f]=M(c[f]));f=0;for(m=a.length;f<m;f++){var l=a[f],k="morphTarget"+f;if(e&&void 0!==
l.POSITION){var p=g[f];p.name=k;for(var n=b.attributes.position,h=0,q=p.count;h<q;h++)p.setXYZ(h,p.getX(h)+n.getX(h),p.getY(h)+n.getY(h),p.getZ(h)+n.getZ(h))}if(d&&void 0!==l.NORMAL)for(l=c[f],l.name=k,k=b.attributes.normal,h=0,q=l.count;h<q;h++)l.setXYZ(h,l.getX(h)+k.getX(h),l.getY(h)+k.getY(h),l.getZ(h)+k.getZ(h))}e&&(b.morphAttributes.position=g);d&&(b.morphAttributes.normal=c);return b})}function Z(b){var a=b.extensions&&b.extensions[h.KHR_DRACO_MESH_COMPRESSION];return a?"draco:"+a.bufferView+
":"+a.indices+":"+N(a.attributes):b.indices+":"+N(b.attributes)+":"+b.mode}function N(b){for(var a="",c=Object.keys(b).sort(),e=0,d=c.length;e<d;e++)a+=c[e]+":"+b[c[e]]+";";return a}function M(b){if(b.isInterleavedBufferAttribute){for(var a=b.count,c=b.itemSize,e=b.array.slice(0,a*c),d=0,g=0;d<a;++d)e[g++]=b.getX(d),2<=c&&(e[g++]=b.getY(d)),3<=c&&(e[g++]=b.getZ(d)),4<=c&&(e[g++]=b.getW(d));return new THREE.BufferAttribute(e,c,b.normalized)}return b.clone()}function q(b,a,c){this.json=b||{};this.extensions=
a||{};this.options=c||{};this.cache=new U;this.primitiveCache={};this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer");"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function O(b,a,c){function e(a,d){return c.getDependency("accessor",a).then(function(a){b.setAttribute(d,a)})}var d=a.attributes,
g=[],f;for(f in d){var k=E[f]||f.toLowerCase();k in b.attributes||g.push(e(d[f],k))}void 0===a.indices||b.index||(d=c.getDependency("accessor",a.indices).then(function(a){b.setIndex(a)}),g.push(d));t(b,a);return Promise.all(g).then(function(){return void 0!==a.targets?Y(b,a.targets,c):b})}y.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:y,load:function(b,a,c,e){var d=this,g;g=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(b);
d.manager.itemStart(b);var f=function(a){e?e(a):console.error(a);d.manager.itemError(b);d.manager.itemEnd(b)},k=new THREE.FileLoader(d.manager);k.setPath(this.path);k.setResponseType("arraybuffer");"use-credentials"===d.crossOrigin&&k.setWithCredentials(!0);k.load(b,function(c){try{d.parse(c,g,function(c){a(c);d.manager.itemEnd(b)},f)}catch(l){f(l)}},c,f)},setDRACOLoader:function(b){this.dracoLoader=b;return this},setDDSLoader:function(b){this.ddsLoader=b;return this},parse:function(b,a,c,e){var d=
{};if("string"!==typeof b)if(THREE.LoaderUtils.decodeText(new Uint8Array(b,0,4))===H){try{d[h.KHR_BINARY_GLTF]=new W(b)}catch(m){e&&e(m);return}b=d[h.KHR_BINARY_GLTF].content}else b=THREE.LoaderUtils.decodeText(new Uint8Array(b));b=JSON.parse(b);if(void 0===b.asset||2>b.asset.version[0])e&&e(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(b.extensionsUsed)for(var g=0;g<b.extensionsUsed.length;++g){var f=b.extensionsUsed[g],k=
b.extensionsRequired||[];switch(f){case h.KHR_LIGHTS_PUNCTUAL:d[f]=new G(b);break;case h.KHR_MATERIALS_UNLIT:d[f]=new D;break;case h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:d[f]=new X;break;case h.KHR_DRACO_MESH_COMPRESSION:d[f]=new J(b,this.dracoLoader);break;case h.MSFT_TEXTURE_DDS:d[h.MSFT_TEXTURE_DDS]=new V(this.ddsLoader);break;case h.KHR_TEXTURE_TRANSFORM:d[h.KHR_TEXTURE_TRANSFORM]=new K;break;default:0<=k.indexOf(f)&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}(new q(b,d,{path:a||
this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager})).parse(c,e)}}});var h={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};G.prototype.loadLight=function(b){var a=this.lightDefs[b],c;c=new THREE.Color(16777215);
void 0!==a.color&&c.fromArray(a.color);var e=void 0!==a.range?a.range:0;switch(a.type){case "directional":c=new THREE.DirectionalLight(c);c.target.position.set(0,0,-1);c.add(c.target);break;case "point":c=new THREE.PointLight(c);c.distance=e;break;case "spot":c=new THREE.SpotLight(c);c.distance=e;a.spot=a.spot||{};a.spot.innerConeAngle=void 0!==a.spot.innerConeAngle?a.spot.innerConeAngle:0;a.spot.outerConeAngle=void 0!==a.spot.outerConeAngle?a.spot.outerConeAngle:Math.PI/4;c.angle=a.spot.outerConeAngle;
c.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle;c.target.position.set(0,0,-1);c.add(c.target);break;default:throw Error('THREE.GLTFLoader: Unexpected light type, "'+a.type+'".');}c.position.set(0,0,0);c.decay=2;void 0!==a.intensity&&(c.intensity=a.intensity);c.name=a.name||"light_"+b;return Promise.resolve(c)};D.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial};D.prototype.extendParams=function(b,a,c){var e=[];b.color=new THREE.Color(1,1,1);b.opacity=1;if(a=a.pbrMetallicRoughness){if(Array.isArray(a.baseColorFactor)){var d=
a.baseColorFactor;b.color.fromArray(d);b.opacity=d[3]}void 0!==a.baseColorTexture&&e.push(c.assignTexture(b,"map",a.baseColorTexture))}return Promise.all(e)};var H="glTF",z=12,I={JSON:1313821514,BIN:5130562};J.prototype.decodePrimitive=function(b,a){var c=this.json,e=this.dracoLoader,d=b.extensions[this.name].bufferView,g=b.extensions[this.name].attributes,f={},k={},m={},l;for(l in g){var n=E[l]||l.toLowerCase();f[n]=g[l]}for(l in b.attributes)if(n=E[l]||l.toLowerCase(),void 0!==g[l]){var p=c.accessors[b.attributes[l]];
m[n]=F[p.componentType];k[n]=!0===p.normalized}return a.getDependency("bufferView",d).then(function(a){return new Promise(function(b){e.decodeDracoFile(a,function(a){for(var c in a.attributes){var d=a.attributes[c],e=k[c];void 0!==e&&(d.normalized=e)}b(a)},f,m)})})};K.prototype.extendTexture=function(b,a){b=b.clone();void 0!==a.offset&&b.offset.fromArray(a.offset);void 0!==a.rotation&&(b.rotation=a.rotation);void 0!==a.scale&&b.repeat.fromArray(a.scale);void 0!==a.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+
this.name+'" extension not yet supported.');b.needsUpdate=!0;return b};r.prototype=Object.create(THREE.Interpolant.prototype);r.prototype.constructor=r;r.prototype.copySampleValue_=function(b){var a=this.resultBuffer,c=this.sampleValues,e=this.valueSize;b=b*e*3+e;for(var d=0;d!==e;d++)a[d]=c[b+d];return a};r.prototype.beforeStart_=r.prototype.copySampleValue_;r.prototype.afterEnd_=r.prototype.copySampleValue_;r.prototype.interpolate_=function(b,a,c,e){var d=this.resultBuffer,g=this.sampleValues,f=
this.valueSize,k=2*f,m=3*f;e-=a;a=(c-a)/e;c=a*a;var l=c*a;b*=m;var m=b-m,n=-2*l+3*c,l=l-c,p=1-n;a=l-c+a;for(c=0;c!==f;c++)d[c]=p*g[m+c+f]+a*g[m+c+k]*e+n*g[b+c+f]+l*g[b+c]*e;return d};var F={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},P={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},Q={33071:THREE.ClampToEdgeWrapping,
33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},aa={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},S={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat},
T;q.prototype.parse=function(b,a){var c=this,e=this.json,d=this.extensions;this.cache.removeAll();this.markDefs();Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(a){a={scene:a[0][e.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:e.asset,parser:c,userData:{}};v(d,a,e);t(a,e);b(a)})["catch"](a)};q.prototype.markDefs=function(){for(var b=this.json.nodes||[],a=this.json.skins||[],c=this.json.meshes||[],e={},d={},g=0,
f=a.length;g<f;g++)for(var k=a[g].joints,m=0,l=k.length;m<l;m++)b[k[m]].isBone=!0;a=0;for(g=b.length;a<g;a++)f=b[a],void 0!==f.mesh&&(void 0===e[f.mesh]&&(e[f.mesh]=d[f.mesh]=0),e[f.mesh]++,void 0!==f.skin&&(c[f.mesh].isSkinnedMesh=!0));this.json.meshReferences=e;this.json.meshUses=d};q.prototype.getDependency=function(b,a){var c=b+":"+a,e=this.cache.get(c);if(!e){switch(b){case "scene":e=this.loadScene(a);break;case "node":e=this.loadNode(a);break;case "mesh":e=this.loadMesh(a);break;case "accessor":e=
this.loadAccessor(a);break;case "bufferView":e=this.loadBufferView(a);break;case "buffer":e=this.loadBuffer(a);break;case "material":e=this.loadMaterial(a);break;case "texture":e=this.loadTexture(a);break;case "skin":e=this.loadSkin(a);break;case "animation":e=this.loadAnimation(a);break;case "camera":e=this.loadCamera(a);break;case "light":e=this.extensions[h.KHR_LIGHTS_PUNCTUAL].loadLight(a);break;default:throw Error("Unknown type: "+b);}this.cache.add(c,e)}return e};q.prototype.getDependencies=
function(b){var a=this.cache.get(b);if(!a){var c=this,a=Promise.all((this.json[b+("mesh"===b?"es":"s")]||[]).map(function(a,d){return c.getDependency(b,d)}));this.cache.add(b,a)}return a};q.prototype.loadBuffer=function(b){var a=this.json.buffers[b],c=this.fileLoader;if(a.type&&"arraybuffer"!==a.type)throw Error("THREE.GLTFLoader: "+a.type+" buffer type is not supported.");if(void 0===a.uri&&0===b)return Promise.resolve(this.extensions[h.KHR_BINARY_GLTF].body);var e=this.options;return new Promise(function(b,
g){c.load(L(a.uri,e.path),b,void 0,function(){g(Error('THREE.GLTFLoader: Failed to load buffer "'+a.uri+'".'))})})};q.prototype.loadBufferView=function(b){var a=this.json.bufferViews[b];return this.getDependency("buffer",a.buffer).then(function(b){var c=a.byteOffset||0;return b.slice(c,c+(a.byteLength||0))})};q.prototype.loadAccessor=function(b){var a=this,c=this.json,e=this.json.accessors[b];if(void 0===e.bufferView&&void 0===e.sparse)return Promise.resolve(null);b=[];void 0!==e.bufferView?b.push(this.getDependency("bufferView",
e.bufferView)):b.push(null);void 0!==e.sparse&&(b.push(this.getDependency("bufferView",e.sparse.indices.bufferView)),b.push(this.getDependency("bufferView",e.sparse.values.bufferView)));return Promise.all(b).then(function(b){var d=b[0],f=R[e.type],k=F[e.componentType],m=k.BYTES_PER_ELEMENT,l=e.byteOffset||0,n=void 0!==e.bufferView?c.bufferViews[e.bufferView].byteStride:void 0,p=!0===e.normalized,h;if(n&&n!==m*f){h=Math.floor(l/n);var x="InterleavedBuffer:"+e.bufferView+":"+e.componentType+":"+h+":"+
e.count,C=a.cache.get(x);C||(h=new k(d,h*n,e.count*n/m),C=new THREE.InterleavedBuffer(h,n/m),a.cache.add(x,C));m=new THREE.InterleavedBufferAttribute(C,f,l%n/m,p)}else h=null===d?new k(e.count*f):new k(d,l,e.count*f),m=new THREE.BufferAttribute(h,f,p);if(void 0!==e.sparse)for(n=e.sparse.values.byteOffset||0,l=new F[e.sparse.indices.componentType](b[1],e.sparse.indices.byteOffset||0,e.sparse.count*R.SCALAR),b=new k(b[2],n,e.sparse.count*f),null!==d&&(m=new THREE.BufferAttribute(m.array.slice(),m.itemSize,
m.normalized)),d=0,k=l.length;d<k;d++)if(n=l[d],m.setX(n,b[d*f]),2<=f&&m.setY(n,b[d*f+1]),3<=f&&m.setZ(n,b[d*f+2]),4<=f&&m.setW(n,b[d*f+3]),5<=f)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.");return m})};q.prototype.loadTexture=function(b){var a=this,c=this.json,e=this.options,d=this.textureLoader,g=window.URL||window.webkitURL,f=c.textures[b],k=f.extensions||{},m;m=k[h.MSFT_TEXTURE_DDS]?c.images[k[h.MSFT_TEXTURE_DDS].source]:c.images[f.source];var l=m.uri,n=!1;void 0!==
m.bufferView&&(l=a.getDependency("bufferView",m.bufferView).then(function(a){n=!0;a=new Blob([a],{type:m.mimeType});return l=g.createObjectURL(a)}));return Promise.resolve(l).then(function(b){var c=e.manager.getHandler(b);c||(c=k[h.MSFT_TEXTURE_DDS]?a.extensions[h.MSFT_TEXTURE_DDS].ddsLoader:d);return new Promise(function(a,d){c.load(L(b,e.path),a,void 0,d)})}).then(function(a){!0===n&&g.revokeObjectURL(l);a.flipY=!1;void 0!==f.name&&(a.name=f.name);m.mimeType in S&&(a.format=S[m.mimeType]);var b=
(c.samplers||{})[f.sampler]||{};a.magFilter=P[b.magFilter]||THREE.LinearFilter;a.minFilter=P[b.minFilter]||THREE.LinearMipmapLinearFilter;a.wrapS=Q[b.wrapS]||THREE.RepeatWrapping;a.wrapT=Q[b.wrapT]||THREE.RepeatWrapping;return a})};q.prototype.assignTexture=function(b,a,c){var e=this;return this.getDependency("texture",c.index).then(function(d){if(!d.isCompressedTexture)switch(a){case "aoMap":case "emissiveMap":case "metalnessMap":case "normalMap":case "roughnessMap":d.format=THREE.RGBFormat}if(e.extensions[h.KHR_TEXTURE_TRANSFORM]){var g=
void 0!==c.extensions?c.extensions[h.KHR_TEXTURE_TRANSFORM]:void 0;g&&(d=e.extensions[h.KHR_TEXTURE_TRANSFORM].extendTexture(d,g))}b[a]=d})};q.prototype.assignFinalMaterial=function(b){var a=b.geometry,c=b.material,e=this.extensions,d=void 0!==a.attributes.tangent,g=void 0!==a.attributes.color,f=void 0===a.attributes.normal,k=!0===b.isSkinnedMesh,m=0<Object.keys(a.morphAttributes).length,l=m&&void 0!==a.morphAttributes.normal;if(b.isPoints){var n="PointsMaterial:"+c.uuid,p=this.cache.get(n);p||(p=
new THREE.PointsMaterial,THREE.Material.prototype.copy.call(p,c),p.color.copy(c.color),p.map=c.map,p.lights=!1,p.sizeAttenuation=!1,this.cache.add(n,p));c=p}else b.isLine&&(n="LineBasicMaterial:"+c.uuid,p=this.cache.get(n),p||(p=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(p,c),p.color.copy(c.color),p.lights=!1,this.cache.add(n,p)),c=p);if(d||g||f||k||m)n="ClonedMaterial:"+c.uuid+":",c.isGLTFSpecularGlossinessMaterial&&(n+="specular-glossiness:"),k&&(n+="skinning:"),d&&(n+="vertex-tangents:"),
g&&(n+="vertex-colors:"),f&&(n+="flat-shading:"),m&&(n+="morph-targets:"),l&&(n+="morph-normals:"),p=this.cache.get(n),p||(p=c.isGLTFSpecularGlossinessMaterial?e[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(c):c.clone(),k&&(p.skinning=!0),d&&(p.vertexTangents=!0),g&&(p.vertexColors=THREE.VertexColors),f&&(p.flatShading=!0),m&&(p.morphTargets=!0),l&&(p.morphNormals=!0),this.cache.add(n,p)),c=p;c.aoMap&&void 0===a.attributes.uv2&&void 0!==a.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),
a.setAttribute("uv2",new THREE.BufferAttribute(a.attributes.uv.array,2)));c.isGLTFSpecularGlossinessMaterial&&(b.onBeforeRender=e[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms);b.material=c};q.prototype.loadMaterial=function(b){var a=this.extensions,c=this.json.materials[b],e,d={},g=c.extensions||{};b=[];if(g[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS])g=a[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],e=g.getMaterialType(),b.push(g.extendParams(d,c,this));else if(g[h.KHR_MATERIALS_UNLIT])g=a[h.KHR_MATERIALS_UNLIT],
e=g.getMaterialType(),b.push(g.extendParams(d,c,this));else{e=THREE.MeshStandardMaterial;g=c.pbrMetallicRoughness||{};d.color=new THREE.Color(1,1,1);d.opacity=1;if(Array.isArray(g.baseColorFactor)){var f=g.baseColorFactor;d.color.fromArray(f);d.opacity=f[3]}void 0!==g.baseColorTexture&&b.push(this.assignTexture(d,"map",g.baseColorTexture));d.metalness=void 0!==g.metallicFactor?g.metallicFactor:1;d.roughness=void 0!==g.roughnessFactor?g.roughnessFactor:1;void 0!==g.metallicRoughnessTexture&&(b.push(this.assignTexture(d,
"metalnessMap",g.metallicRoughnessTexture)),b.push(this.assignTexture(d,"roughnessMap",g.metallicRoughnessTexture)))}!0===c.doubleSided&&(d.side=THREE.DoubleSide);g=c.alphaMode||"OPAQUE";"BLEND"===g?d.transparent=!0:(d.transparent=!1,"MASK"===g&&(d.alphaTest=void 0!==c.alphaCutoff?c.alphaCutoff:.5));void 0!==c.normalTexture&&e!==THREE.MeshBasicMaterial&&(b.push(this.assignTexture(d,"normalMap",c.normalTexture)),d.normalScale=new THREE.Vector2(1,1),void 0!==c.normalTexture.scale&&d.normalScale.set(c.normalTexture.scale,
c.normalTexture.scale));void 0!==c.occlusionTexture&&e!==THREE.MeshBasicMaterial&&(b.push(this.assignTexture(d,"aoMap",c.occlusionTexture)),void 0!==c.occlusionTexture.strength&&(d.aoMapIntensity=c.occlusionTexture.strength));void 0!==c.emissiveFactor&&e!==THREE.MeshBasicMaterial&&(d.emissive=(new THREE.Color).fromArray(c.emissiveFactor));void 0!==c.emissiveTexture&&e!==THREE.MeshBasicMaterial&&b.push(this.assignTexture(d,"emissiveMap",c.emissiveTexture));return Promise.all(b).then(function(){var b;
b=e===THREE.ShaderMaterial?a[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(d):new e(d);void 0!==c.name&&(b.name=c.name);t(b,c);c.extensions&&v(a,b,c);return b})};q.prototype.loadGeometries=function(b){function a(a){return e[h.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,c).then(function(b){return O(b,a,c)})}for(var c=this,e=this.extensions,d=this.primitiveCache,g=[],f=0,k=b.length;f<k;f++){var m=b[f],l=Z(m),n=d[l];n?g.push(n.promise):(n=m.extensions&&m.extensions[h.KHR_DRACO_MESH_COMPRESSION]?
a(m):O(new THREE.BufferGeometry,m,c),d[l]={primitive:m,promise:n},g.push(n))}return Promise.all(g)};q.prototype.loadMesh=function(b){for(var a=this,c=this.json.meshes[b],e=c.primitives,d=[],g=0,f=e.length;g<f;g++){var k;k=void 0===e[g].material?T=T||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):this.getDependency("material",e[g].material);d.push(k)}return Promise.all(d).then(function(d){return a.loadGeometries(e).then(function(f){for(var g=
[],m=0,l=f.length;m<l;m++){var k=f[m],h=e[m],q=d[m];if(4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)k=!0===c.isSkinnedMesh?new THREE.SkinnedMesh(k,q):new THREE.Mesh(k,q),!0!==k.isSkinnedMesh||k.geometry.attributes.skinWeight.normalized||k.normalizeSkinWeights(),5===h.mode?k.drawMode=THREE.TriangleStripDrawMode:6===h.mode&&(k.drawMode=THREE.TriangleFanDrawMode);else if(1===h.mode)k=new THREE.LineSegments(k,q);else if(3===h.mode)k=new THREE.Line(k,q);else if(2===h.mode)k=new THREE.LineLoop(k,
q);else if(0===h.mode)k=new THREE.Points(k,q);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);if(0<Object.keys(k.geometry.morphAttributes).length){var h=k,u=c;h.updateMorphTargets();if(void 0!==u.weights)for(var q=0,r=u.weights.length;q<r;q++)h.morphTargetInfluences[q]=u.weights[q];if(u.extras&&Array.isArray(u.extras.targetNames))if(u=u.extras.targetNames,h.morphTargetInfluences.length===u.length)for(h.morphTargetDictionary={},q=0,r=u.length;q<r;q++)h.morphTargetDictionary[u[q]]=
q;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}k.name=c.name||"mesh_"+b;1<f.length&&(k.name+="_"+m);t(k,c);a.assignFinalMaterial(k);g.push(k)}if(1===g.length)return g[0];f=new THREE.Group;m=0;for(l=g.length;m<l;m++)f.add(g[m]);return f})})};q.prototype.loadCamera=function(b){var a;b=this.json.cameras[b];var c=b[b.type];if(c)return"perspective"===b.type?a=new THREE.PerspectiveCamera(THREE.Math.radToDeg(c.yfov),c.aspectRatio||1,c.znear||1,c.zfar||2E6):"orthographic"===
b.type&&(a=new THREE.OrthographicCamera(c.xmag/-2,c.xmag/2,c.ymag/2,c.ymag/-2,c.znear,c.zfar)),void 0!==b.name&&(a.name=b.name),t(a,b),Promise.resolve(a);console.warn("THREE.GLTFLoader: Missing camera parameters.")};q.prototype.loadSkin=function(b){b=this.json.skins[b];var a={joints:b.joints};return void 0===b.inverseBindMatrices?Promise.resolve(a):this.getDependency("accessor",b.inverseBindMatrices).then(function(b){a.inverseBindMatrices=b;return a})};q.prototype.loadAnimation=function(b){for(var a=
this.json.animations[b],c=[],e=[],d=[],g=[],f=[],k=0,m=a.channels.length;k<m;k++){var l=a.channels[k],h=a.samplers[l.sampler],l=l.target,p=void 0!==a.parameters?a.parameters[h.input]:h.input,q=void 0!==a.parameters?a.parameters[h.output]:h.output;c.push(this.getDependency("node",void 0!==l.node?l.node:l.id));e.push(this.getDependency("accessor",p));d.push(this.getDependency("accessor",q));g.push(h);f.push(l)}return Promise.all([Promise.all(c),Promise.all(e),Promise.all(d),Promise.all(g),Promise.all(f)]).then(function(c){var d=
c[0],e=c[1],f=c[2],g=c[3];c=c[4];for(var k=[],m=0,h=d.length;m<h;m++){var l=d[m],n=e[m],p=f[m],q=g[m],t=c[m];if(void 0!==l){l.updateMatrix();l.matrixAutoUpdate=!0;var B;switch(A[t.path]){case A.weights:B=THREE.NumberKeyframeTrack;break;case A.rotation:B=THREE.QuaternionKeyframeTrack;break;default:B=THREE.VectorKeyframeTrack}var x=l.name?l.name:l.uuid,z=void 0!==q.interpolation?aa[q.interpolation]:THREE.InterpolateLinear,v=[];A[t.path]===A.weights?l.traverse(function(a){!0===a.isMesh&&a.morphTargetInfluences&&
v.push(a.name?a.name:a.uuid)}):v.push(x);l=p.array;if(p.normalized){var w;if(l.constructor===Int8Array)w=1/127;else if(l.constructor===Uint8Array)w=1/255;else if(l.constructor==Int16Array)w=1/32767;else if(l.constructor===Uint16Array)w=1/65535;else throw Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var y=new Float32Array(l.length),p=0,x=l.length;p<x;p++)y[p]=l[p]*w;l=y}p=0;for(x=v.length;p<x;p++)w=new B(v[p]+"."+A[t.path],n.array,l,z),"CUBICSPLINE"===q.interpolation&&
(w.createInterpolant=function(a){return new r(this.times,this.values,this.getValueSize()/3,a)},w.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),k.push(w)}}return new THREE.AnimationClip(void 0!==a.name?a.name:"animation_"+b,void 0,k)})};q.prototype.loadNode=function(b){var a=this.json,c=this.extensions,e=this,d=a.meshReferences,g=a.meshUses,f=a.nodes[b];return function(){var a=[];void 0!==f.mesh&&a.push(e.getDependency("mesh",f.mesh).then(function(a){var b;if(1<d[f.mesh]){var c=g[f.mesh]++;
b=a.clone();b.name+="_instance_"+c;b.onBeforeRender=a.onBeforeRender;for(var e=0,k=b.children.length;e<k;e++)b.children[e].name+="_instance_"+c,b.children[e].onBeforeRender=a.children[e].onBeforeRender}else b=a;void 0!==f.weights&&b.traverse(function(a){if(a.isMesh)for(var b=0,c=f.weights.length;b<c;b++)a.morphTargetInfluences[b]=f.weights[b]});return b}));void 0!==f.camera&&a.push(e.getDependency("camera",f.camera));f.extensions&&f.extensions[h.KHR_LIGHTS_PUNCTUAL]&&void 0!==f.extensions[h.KHR_LIGHTS_PUNCTUAL].light&&
a.push(e.getDependency("light",f.extensions[h.KHR_LIGHTS_PUNCTUAL].light));return Promise.all(a)}().then(function(a){var b;b=!0===f.isBone?new THREE.Bone:1<a.length?new THREE.Group:1===a.length?a[0]:new THREE.Object3D;if(b!==a[0])for(var d=0,e=a.length;d<e;d++)b.add(a[d]);void 0!==f.name&&(b.userData.name=f.name,b.name=THREE.PropertyBinding.sanitizeNodeName(f.name));t(b,f);f.extensions&&v(c,b,f);void 0!==f.matrix?(a=new THREE.Matrix4,a.fromArray(f.matrix),b.applyMatrix(a)):(void 0!==f.translation&&
b.position.fromArray(f.translation),void 0!==f.rotation&&b.quaternion.fromArray(f.rotation),void 0!==f.scale&&b.scale.fromArray(f.scale));return b})};q.prototype.loadScene=function(){function b(a,c,e,d){var g=e.nodes[a];return d.getDependency("node",a).then(function(a){if(void 0===g.skin)return a;var b;return d.getDependency("skin",g.skin).then(function(a){b=a;a=[];for(var c=0,e=b.joints.length;c<e;c++)a.push(d.getDependency("node",b.joints[c]));return Promise.all(a)}).then(function(c){a.traverse(function(a){if(a.isMesh){for(var d=
[],e=[],f=0,g=c.length;f<g;f++){var h=c[f];h?(d.push(h),h=new THREE.Matrix4,void 0!==b.inverseBindMatrices&&h.fromArray(b.inverseBindMatrices.array,16*f),e.push(h)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',b.joints[f])}a.bind(new THREE.Skeleton(d,e),a.matrixWorld)}});return a})}).then(function(a){c.add(a);var f=[];if(g.children)for(var h=g.children,l=0,n=h.length;l<n;l++)f.push(b(h[l],a,e,d));return Promise.all(f)})}return function(a){var c=this.json,e=this.extensions;a=this.json.scenes[a];
var d=new THREE.Scene;void 0!==a.name&&(d.name=a.name);t(d,a);a.extensions&&v(e,d,a);e=a.nodes||[];a=[];for(var g=0,f=e.length;g<f;g++)a.push(b(e[g],d,c,this));return Promise.all(a).then(function(){return d})}}();return y}();